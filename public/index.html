<!DOCTYPE html> 
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>YHASNæ–½è¨­äºˆç´„ğŸ©µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background-color: #e8f5e9;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px;
    }
    h1 {
      text-align: center;
      color: #43a047;
    }
    .container {
  display: block; /* ã‚‚ã—ãã¯ flex ã®ã¾ã¾ã§OKã ãŒ */
  width: 100%;
  max-width: 1400px;
  margin: auto;
}

#topButtons {
  position: absolute;
  top: 20px;
  right: 30px;
  z-index: 999;
}
#topButtons button {
	margin-left: 10px;
}

    label, p {
      font-size: 16px;
      color: #333;
    }
  /* === è¡¨ã®è¦‹ãŸç›®ã‚’â€œå…ƒã®é›°å›²æ°—â€ã«æˆ»ã—ã¤ã¤æ•´ãˆã‚‹ === */
/* === ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼šæœ€åˆã®è¦‹ãŸç›®ã«å¯„ã›ã‚‹ï¼ˆå°ã•ã‚ãƒ»ä¸­å¤®å¯„ã›ï¼‰ === */


.container {
  width: 100%;
  max-width: 980px;            /* è¡¨å«ã‚å…¨ä½“ã®æœ€å¤§å¹…ã‚’æŠ‘ãˆã‚‹ */
  margin: 0 auto;
}

/* ã‚¿ã‚¤ãƒˆãƒ«ã‚„è¦‹å‡ºã—ã‚’ã‚„ã‚„å°ã•ã‚ã« */
h1 { font-size: 22px; margin: 18px 0 12px; }
h2 { font-size: 18px; margin: 14px 0 8px; }
h3 { font-size: 16px; margin: 12px 0 6px; }

/* ãƒœã‚¿ãƒ³ã‚’å°ã•ã‚ã«ï¼ˆé«˜ã•ãƒ»ãƒ•ã‚©ãƒ³ãƒˆï¼‰ */
button {
  padding: 8px 14px;
  font-size: 14px;
  border-radius: 4px;
}
#dateControls {
  gap: 6px;
  margin-bottom: 8px;
}
#dateControls label { font-size: 14px; }

/* === ã€Œå‰ã®æ—¥ãƒ»æ—¥ä»˜é¸æŠãƒ»æ¬¡ã®æ—¥ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸­å¤®å¯„ã› === */
#dateControls {
  /* æ¨ªä¸¦ã³ï¼‹ä¸­å¤®å¯„ã› */
  display: flex;
  justify-content: center;  /* â†ä¸­å¤®å¯„ã›ã®ä¸»å½¹ */
  align-items: center;
  gap: 12px;

  /* è¡Œã‚’ãƒšãƒ¼ã‚¸ã®ä¸­å¤®ã«ç½®ããŸã‚ã®è£œåŠ© */
  margin: 10px auto 16px;   /* ä¸Šä¸‹ä½™ç™½ï¼‹å·¦å³autoã§ä¸­å¤® */
  width: 100%;
  max-width: 900px;         /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§åºƒãŒã‚Šã™ãé˜²æ­¢ï¼ˆä»»æ„ã§èª¿æ•´ï¼‰ */
}

/* å­è¦ç´ ï¼ˆãƒœã‚¿ãƒ³ãƒ»å…¥åŠ›ï¼‰ã¯å¹…ã‚’å‹æ‰‹ã«ä¼¸ã°ã•ãªã„ */
#dateControls > * {
  flex: 0 0 auto;
}

/* æ—¥ä»˜å…¥åŠ›ã®æœ€å°å¹…ï¼†ä¸­å¤®å¯„ã›ï¼ˆflatpickrç­‰ã®ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹æƒ³å®šï¼‰ */
#dateControls input[type="text"],
#dateControls input[type="date"] {
  min-width: 160px;         /* å¿…è¦ã«å¿œã˜ã¦ 140px ãªã©ã¸ */
  text-align: center;
}

/* ã‚¹ãƒãƒ›ã¯ã•ã‚‰ã«é–“éš”ã‚’è©°ã‚ã‚‹ */
@media (max-width: 480px) {
  #dateControls { gap: 8px; max-width: 100%; }
  #dateControls input[type="text"],
  #dateControls input[type="date"] { min-width: 140px; }
}


/* è¡¨ãƒ©ãƒƒãƒ‘ãƒ¼ï¼šæ¨ªã«ä¼¸ã³ã™ããªã„ï¼†ä¸­å¤®å¯„ã› */
#scheduleTableRooms, #scheduleTableBeds {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

#scheduleTableRooms table,
#scheduleTableBeds table {
  width: 96%;
  max-width: 900px;
  margin: 10px auto;
  border-collapse: separate;
  border-spacing: 0;
  background: #fff;
  border: 1px solid #a5d6a7;
  border-radius: 6px;   /* è§’ä¸¸ã¯ãã®ã¾ã¾ */
  position: relative;   /* sticky ã®åŸºæº–ã‚’å®‰å®šã•ã›ã‚‹ */
  /* overflow: hidden;  â† sticky ãŒåŠ¹ã‹ãªããªã‚‹ã®ã§ä½¿ã‚ãªã„ */
}

/* ãƒ˜ãƒƒãƒ€ï¼ˆæ™‚é–“å¸¯ãƒ»éƒ¨å±‹åï¼‰ */
#scheduleTableRooms th,
#scheduleTableBeds th {
  background-color: #a5d6a7;
  color: #fff;
  padding: 6px 8px;            /* ä½™ç™½ã‚’å°ã•ã‚ã« */
  text-align: center;
  white-space: nowrap;
  font-weight: 700;
  font-size: 13px;             /* æ–‡å­—ã‚‚ã‚„ã‚„å°ã•ã‚ */
}

/* å·¦ç«¯ã®æ™‚é–“åˆ—ï¼ˆtbody > thï¼‰ã¯æ·¡ã„èƒŒæ™¯ã§åŒºåˆ¥ã€æŠ˜è¿”ã—OK */
#scheduleTableRooms tbody th,
#scheduleTableBeds tbody th {
  white-space: normal;
  color: #333;
  background-color: #e7ffe9;
  font-weight: 700;
  padding: 6px 8px;
  font-size: 13px;
}

/* ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ï¼šé«˜ã•/ä½™ç™½ã‚’æ§ãˆã‚ã« */
#scheduleTableRooms td,
#scheduleTableBeds td {
  background-color: #fff;
  border: 1px solid #81c784;
  padding: 6px 8px;            /* ä½™ç™½ã‚’å°ã•ã‚ã« */
  text-align: center;
  height: 32px;                /* ãƒ‡ãƒ•ã‚©ç›®å®‰ã‚’å°‘ã—ä½ã‚ã« */
  vertical-align: middle;
  font-size: 13px;             /* æ–‡å­—ã‚‚ã‚„ã‚„å°ã•ã‚ */
}

/* === å·¦ç«¯ã®ã€Œæ™‚é–“å¸¯ã€åˆ—ã‚’æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã‚‚å›ºå®šè¡¨ç¤ºã«ã™ã‚‹ === */

/* æ¼”ç¿’å®¤ãƒ»äº¤æµå®¤ãƒ†ãƒ¼ãƒ–ãƒ«ã®å·¦ç«¯åˆ—ï¼ˆãƒ˜ãƒƒãƒ€ï¼‹å„è¡Œï¼‰ */
#scheduleTableRooms table thead th:first-child,
#scheduleTableRooms table tbody th:first-child {
  position: sticky;
  left: 0;
  z-index: 3;                /* ä»–ã®ã‚»ãƒ«ã‚ˆã‚Šå‰é¢ã« */
  background-color: #e7ffe9; /* æ—¢å­˜ã®æ™‚é–“å¸¯ã‚»ãƒ«ã¨åŒã˜è‰²ã§å¡—ã‚Šç›´ã— */
}

/* === stickyåˆ—ã«å½±ã‚’ã¤ã‘ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®æ®µå·®ã‚’æ˜ç¢ºã«ã™ã‚‹ === */
#scheduleTableRooms table thead th:first-child,
#scheduleTableRooms table tbody th:first-child,
#scheduleTableBeds table thead th:first-child,
#scheduleTableBeds table tbody th:first-child {
  box-shadow: 3px 0 6px rgba(0,0,0,0.18); /* â† å³æ–¹å‘ã«è–„ã„å½± */
  backdrop-filter: blur(1px);             /* æ»‘ã‚‰ã‹ã•UPï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰ */
  z-index: 5;                              /* ä»–ã¨é‡ãªã‚‰ãªã„ã‚ˆã†å¼·ã‚ */
}

/* === å·¦ä¸Šã‚»ãƒ«ã€Œæ™‚é–“å¸¯ã€ã ã‘æ¿ƒã„ç·‘ã«å¤‰æ›´ï¼ˆä»–ãƒ˜ãƒƒãƒ€ã¨åŒã˜è‰²ï¼‰ === */
#scheduleTableRooms table thead th:first-child,
#scheduleTableBeds table thead th:first-child {
  background-color: #a5d6a7 !important;
  color: #fff;
}

/* ãƒ™ãƒƒãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«ã®å·¦ç«¯åˆ—ï¼ˆãƒ˜ãƒƒãƒ€ï¼‹å„è¡Œï¼‰ */
#scheduleTableBeds table thead th:first-child,
#scheduleTableBeds table tbody th:first-child {
  position: sticky;
  left: 0;
  z-index: 3;
  background-color: #e7ffe9; /* ã“ã¡ã‚‰ã‚‚æ™‚é–“å¸¯åˆ—ã®æ·¡ã„ç·‘ã§çµ±ä¸€ */
}

/* äºˆç´„æ¸ˆã¿ã‚»ãƒ« */
td.disabled {
  background-color: #cfead0;   /* å°‘ã—ã ã‘æ·¡ã„ç·‘ã«èª¿æ•´ */
  color: #666;
  cursor: not-allowed;
}

/* ç”»åƒï¼šã¯ã˜ã‚ã‹ã‚‰å°ã•ã‚ã«ï¼ˆå¿…è¦æ™‚ã«æ‹¡å¤§ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ï¼‰ */
.image-section img {
  width: 52%;
  max-width: 420px;            /* ä»¥å‰ã«è¿‘ã„å°ã•ã• */
  border: 1px solid #ccc;
  border-radius: 6px;
  margin: 12px auto;
  cursor: zoom-in;
  display: block;
}

/* å®Œäº†ç”»é¢ã‚‚å°‘ã—ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ */
#completeSection h2 { font-size: 22px; }
#completeInfo     { font-size: 16px; }



      th:first-child,
      td:first-child{
        white-space: nowrap;
    }
    td.disabled {
      background-color: #c8e6c9;
      color: #999;
      cursor: not-allowed;
    }
  
    button {
      background-color: #66bb6a;
      color: #fff;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #4caf50;
    }
    
    #topRightLinks {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}
#topRightLinks a {
  display: inline-block;
  margin-right: 10px;
  padding: 10px 16px;
  background-color: #43a047;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  font-size: 14px;
}
#topRightLinks a:hover {
  background-color: #2e7d32;
}
    
    #dateControls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
#completeSection {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 60vh; /* é«˜ã•ã§ä¸­å¤®å¯„ã› */
  text-align: center;
}

#completeSection h2 {
  font-size: 28px;
  margin-bottom: 10px;
  color: #2e7d32;
}

#completeInfo {
  font-size: 18px;
  margin-bottom: 20px;
  color: #333;
  font-weight: normal; /* å¤ªå­—ã‚’è§£é™¤ */
}
    #errorMsg {
      color: red;
      margin-top: 10px;
    }
    #loading {
      text-align: center;
      font-size: 24px;
      color: #4caf50;
      margin: 20px 0;
    }
    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}

.modal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 8px;
  border: 2px solid white;
  animation: fadeInZoom 0.3s ease;
}

.modal:target {
  display: flex;
}

.image-section {
  margin-top: 60px;
  text-align: center;
  width: 100%;
}



@keyframes fadeInZoom {
  0% {
    opacity: 0;
    transform: scale(0.9);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}


/* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
#menuButton {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1100;
  cursor: pointer;
}



#sideMenu {
  position: fixed;
  top: 0;
  left: 0;
  width: 240px;
  height: 100vh;
  background-color: #3b8b3d;
  color: white;
  padding: 20px;
  box-shadow: 2px 0 8px rgba(0,0,0,0.2);
  transform: translateX(-100%);
  transition: transform 0.3s ease;
  z-index: 1101;
}
#sideMenu.visible {
  transform: translateX(0);
}
#sideMenu button {
  width: 100%;
  margin-bottom: 10px;
  background-color: white;
  color: #3b8b3d;
  border: none;
  padding: 10px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
}
#sideMenu hr {
  border: 0;
  height: 1px;
  background-color: #66bb6a;
}


/* æ—¢å­˜ã® #menuOverlay ã«è¿½è¨˜ä¿®æ­£ */
#menuOverlay {
  position: fixed;
  top: 0;
  left: 0px;
  width: calc(100vw);
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.3);
  z-index: 1000;
  opacity: 0; /* â† åˆæœŸã¯é€æ˜ */
  pointer-events: none;
  transition: opacity 0.3s ease; /* â† ãƒ•ã‚§ãƒ¼ãƒ‰ç”¨ */
}

/* è¡¨ç¤ºæ™‚ã®ã‚¯ãƒ©ã‚¹ */
#menuOverlay.show {
  opacity: 1;
  pointer-events: auto;
}


.menu-user {
  text-align: left;
  margin-bottom: 20px;
}

#loginButton {
  background-color: #f57c00 !important; /* é®®ã‚„ã‹ãªã‚ªãƒ¬ãƒ³ã‚¸ */
  color: white;
  font-weight: bold;
  font-size: 18px;
  padding: 14px 28px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: background-color 0.3s, transform 0.2s;
}

#loginButton:hover {
  background-color: #ef6c00 !important;
  transform: scale(1.03);
}

/* === Smooth Select Animation for table cells === */
td.available {
  position: relative;
  background-color: #ffffff !important;
  cursor: pointer;
  /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æºã‚‰ã•ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸­å¿ƒã« */
  will-change: background-color, transform, box-shadow, opacity;
  transition:
    background-color 160ms ease,
    transform 160ms ease,
    box-shadow 200ms ease;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
td.available::after {
  content: "";
  position: absolute;
  inset: 2px;                 /* æ ã«å°‘ã—ä½™ç™½ã‚’ä½œã‚‹ */
  border-radius: 6px;
  background: radial-gradient(closest-side, rgba(76,175,80,0.18), transparent 70%);
  transform: scale(0.9);
  opacity: 0;
  pointer-events: none;
  transition:
    opacity 220ms ease,
    transform 220ms ease;
}
/* ã‚¿ãƒƒãƒ—ç›´å¾Œã®å¾®ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆæŠ¼ã—ãŸæ„Ÿï¼‰ */
td.available.tap-active {
  transform: scale(0.985);
}

/* === ã‚»ãƒ«é¸æŠæ™‚ï¼ˆæ¿ƒã„ã‚ï¼†ç«‹ä½“æ„ŸUPï¼‰ === */
td.available.selected {
  background-color: #d0e8d2 !important;  /* â† å…ƒã‚ˆã‚Šå°‘ã—æ¿ƒã„ç·‘ */
  box-shadow:
    0 0 0 3px rgba(67,160,71,0.35) inset,  /* æ ç·šå¼·ã‚ */
    0 2px 10px rgba(0,0,0,0.08),            /* å¤–å´ã®å½±å°‘ã—å¼·ã‚ */
    inset 0 0 18px rgba(46,125,50,0.18);    /* å†…éƒ¨ã»ã‚ã£ã¨å…‰ */
  transition: background-color 150ms ease,
              box-shadow 200ms ease;
}

td.available.selected::after {
  opacity: 1;
  transform: scale(1.03);  /* ã¡ã‚‡ã£ã¨ã ã‘è†¨ã‚‰ã‚€ â†’ â€œæŠ¼ã—ãŸæ„Ÿï¼‹é¸æŠä¸­â€ */
  background: radial-gradient(
    closest-side,
    rgba(67,160,71,0.28),   /* â† ä¸­å¤®ã®è¼ãã‚°ãƒ©ãƒ‡ã‚’æ¿ƒã */
    transparent 75%
  );
}

/* æœªã‚¯ãƒªãƒƒã‚¯å¯èƒ½æ™‚ */
td.available:not(.clickable) {
  cursor: not-allowed;
}

/* è¦–è¦šéæ•ãƒ»çœé›»åŠ›é…æ…® */
@media (prefers-reduced-motion: reduce) {
  td.available,
  td.available::after {
    transition: none !important;
  }
}

/* === ã‚°ãƒ­ãƒ¼ãƒãƒ«å³æ™‚ã‚¿ãƒƒãƒ—å¯¾ç­– === */
button, a, [role="button"],
#menuButton, #sideMenu button,
#prevDayBtn, #nextDayBtn,
#loginButton, #loginAndReserveButton,
.image-section img, .modal {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation; /* 300msé…å»¶ã‚’æŠ‘æ­¢ */
}
#toCancelButton, #sideLoginButton, #sideLogoutButton, #loginAndReserveButton, #menuOverlay, #imgEnsyuu, #imgBed {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}







/* --- å…¨ä½“ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´ï¼šPC / ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ / ã‚¹ãƒãƒ› --- */

/* PCåŸºæº–ï¼šå°‘ã—ã ã‘ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
body {
  font-size: 15px;
}

/* è¦‹å‡ºã—ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã®åŸºæœ¬ã‚µã‚¤ã‚º */
h1 {
  font-size: 24px;
  margin: 14px 0 10px;
}
label,
p {
  font-size: 15px;
}

/* ãƒ†ãƒ¼ãƒ–ãƒ«ã®åŸºæœ¬ã‚µã‚¤ã‚º */
#scheduleTableRooms th,
#scheduleTableBeds th,
#scheduleTableRooms td,
#scheduleTableBeds td {
  font-size: 13px;
  padding: 6px 8px;
  height: 32px;
}

/* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãã‚‰ã„ï¼ˆæ¨ªå¹… ï½1024pxï¼‰ã§å°‘ã—ã ã‘ç¸®ã‚ã‚‹ */
@media (max-width: 1024px) {
  body {
    font-size: 14px;
    padding: 20px;
  }
  .container {
    max-width: 960px;
  }
  h1 { font-size: 22px; }
}

/* ã‚¹ãƒãƒ›ç¸¦ç”»é¢æƒ³å®šï¼ˆæ¨ªå¹… ï½600pxï¼‰ï¼šæ¨ªé•·ãƒ†ãƒ¼ãƒ–ãƒ«å‰æã§å…¨ä½“ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
@media (max-width: 600px) {
  /* å…¨ä½“ã®æ–‡å­—ã¨ä½™ç™½ã‚’ã•ã‚‰ã«ä¸€æ®µå°ã•ãï¼ˆã»ã¼ 0.8å€ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ */
  body {
    font-size: 10px;
    padding: 6px;
  }

  .container {
    max-width: 100%;
    width: 100%;
    margin: 0 auto;
  }

  h1 {
    font-size: 15px;
    margin: 6px 0 4px;
  }
  label,
  p {
    font-size: 10px;
  }

  /* ãƒœã‚¿ãƒ³ã‚‚ã²ã¨å›ã‚Šå°ã•ã */
  button {
    font-size: 9px;
    padding: 4px 7px;
    border-radius: 4px;
  }

  /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã¨ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
  #menuButton {
    top: 8px;
    left: 8px;
  }
  #sideMenu {
    width: 72vw;
    padding: 12px;
  }

  /* å³ä¸Šãƒœã‚¿ãƒ³ */
  #topButtons {
    top: 8px;
    right: 8px;
  }
  #topButtons button {
    padding: 3px 6px;
    font-size: 8px;
    margin-left: 4px;
  }

  /* æ—¥ä»˜æ“ä½œã¾ã‚ã‚Š */
  #dateControls {
    gap: 4px;
    margin-bottom: 6px;
  }
  #nextDayBtn,
  #prevDayBtn {
    font-size: 8px;
    padding: 3px 5px;
  }
  #selectedDateDisplay {
    font-size: 13px;
    padding: 2px 4px;
  }

  /* ==== ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã€Œæ¨ªé•·å‰æï¼‹ãƒãƒ¼ãƒ©ãƒƒãƒ—ã€ã§å›ºå®šæ°—å‘³ã« ==== */

  /* ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã¯æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã‚‹ */
  #scheduleTableRooms,
  #scheduleTableBeds {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* æ¼”ç¿’å®¤ãƒ»äº¤æµå®¤ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã‹ãªã‚Šç´°ã‚ã«ï¼ˆæ¨ªå¹…ã‚’ã‚­ãƒ¥ãƒƒã¨ï¼‰ */
  #scheduleTableRooms table {
    width: auto;          /* ç”»é¢å¹…ã«åˆã‚ã›ãšã€ä¸­èº«ãƒ™ãƒ¼ã‚¹ã®å¹… */
    min-width: 650px;     /* PCãƒ»iPadã‚ˆã‚Šç´°ã */
    margin: 6px auto;
  }

  /* ãƒ™ãƒƒãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å°‘ã—ã ã‘ç´°ãï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‰æï¼‰ */
  #scheduleTableBeds table {
    width: auto;
    min-width: 900px;
    margin: 6px auto;
  }

  /* æ–‡å­—ã¯ã²ã¨å›ã‚Šå°ã•ã‚ï¼‹ãƒãƒ¼ãƒ©ãƒƒãƒ—ï¼‹é«˜ã•å›ºå®šæ°—å‘³ */
  #scheduleTableRooms th,
  #scheduleTableBeds th,
  #scheduleTableRooms td,
  #scheduleTableBeds td {
    font-size: 10px;
    padding: 3px 5px;
    height: 28px;         /* è¡Œã®é«˜ã•ã®ãƒ™ãƒ¼ã‚¹ã‚’å°‘ã—ä¸‹ã’ã‚‹ */
    white-space: nowrap;  /* è‡ªå‹•æ”¹è¡Œã‚’æ­¢ã‚ã‚‹ï¼ˆ<br> ã ã‘ã§æ”¹è¡Œï¼‰ */
    line-height: 1.2;
  }

  #scheduleTableRooms tbody th,
  #scheduleTableBeds tbody th {
    font-size: 10px;
  }

  /* ==== æ¼”ç¿’å®¤ãƒ»äº¤æµå®¤ï¼ˆRoomsï¼‰åˆ—å¹…ç¸®å°ï¼šå…¨åˆ— 70% ==== */
  #scheduleTableRooms th:first-child,
  #scheduleTableRooms tbody th:first-child {
    min-width: 70px;    /* æ™‚é–“å¸¯ï¼šå…ƒ90px â†’ 70ã¸ç¸®å° */
  }
  #scheduleTableRooms th:not(:first-child),
  #scheduleTableRooms td:not(:first-child) {
    min-width: 56px;    /* ä»–ã®åˆ—ï¼šå…ƒ80px â†’ 70% ã® 56 ã¸ç¸®å° */
  }

  /* ==== ãƒ™ãƒƒãƒ‰ï¼ˆBedsï¼‰åˆ—å¹…èª¿æ•´ ==== */
  /* å·¦ç«¯ï¼ˆæ™‚é–“å¸¯ï¼‰åˆ— â†’ ç´„90% */
  #scheduleTableBeds th:first-child,
  #scheduleTableBeds tbody th:first-child {
    min-width: 72px;    /* 80px â†’ 90% ã® 72px */
  }

  /* ãã®ä»–ãƒ™ãƒƒãƒ‰åˆ— â†’ ç´„80% */
  #scheduleTableBeds th:not(:first-child),
  #scheduleTableBeds td:not(:first-child) {
    min-width: 64px;    /* 80px â†’ 80% ã® 64px */
  }

  /* ç”»åƒã¯ã‚¹ãƒãƒ›å¹…ã«åˆã‚ã›ã‚‹ */
  .image-section {
    margin-top: 14px;
  }
  .image-section img {
    width: 100%;
    max-width: 320px;
    margin: 10px auto;
  }

  /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯è¨±å¯ï¼ˆæ­“è¿ï¼‰ */
  html,
  body {
    overflow-x: auto;
  }
}

/* ã•ã‚‰ã«å°ã•ã„ç«¯æœ«ï¼ˆï½375pxï¼‰ãªã‚‰ã‚‚ã†ä¸€æ®µéšã ã‘æ–‡å­—ã‚’å°‘ã—å°ã•ã */
@media (max-width: 375px) {
  body {
    font-size: 11px;
  }
  #scheduleTableRooms th,
  #scheduleTableBeds th,
  #scheduleTableRooms td,
  #scheduleTableBeds td {
    font-size: 9px;
  }
}


/* === ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼åˆ‡ã‚Šæ›¿ãˆ ===================================== */

/* ãƒ†ãƒ¼ãƒå…¨ä½“ã«ãµã‚ã£ã¨èƒŒæ™¯è‰²ãŒå¤‰ã‚ã‚‹æ„Ÿã˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
body.theme-green,
body.theme-blue,
body.theme-red,
body.theme-yellow {
  transition: background-color 0.25s ease;
}

/* ===== GREENï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šä»Šã®é…è‰²ï¼‰ ===== */
body.theme-green { background-color: #e8f5e9; }
body.theme-green h1 { color: #43a047; }

body.theme-green #scheduleTableRooms th,
body.theme-green #scheduleTableBeds th {
  background-color: #a5d6a7;
}

body.theme-green button {
  background-color: #66bb6a;
}
body.theme-green button:hover {
  background-color: #4caf50;
}

body.theme-green #sideMenu {
  background-color: #3b8b3d;
}
body.theme-green #sideMenu hr {
  background-color: #66bb6a;
}

body.theme-green #topRightLinks a {
  background-color: #43a047;
}
body.theme-green #topRightLinks a:hover {
  background-color: #2e7d32;
}

body.theme-green #noticeArea h2,
body.theme-green #completeSection h2 {
  color: #2e7d32;
}

/* ===== BLUE ===== */
body.theme-blue { background-color: #e3f2fd; }
body.theme-blue h1 { color: #1e88e5; }

body.theme-blue #scheduleTableRooms th,
body.theme-blue #scheduleTableBeds th {
  background-color: #90caf9;
}

body.theme-blue button {
  background-color: #42a5f5;
}
body.theme-blue button:hover {
  background-color: #1e88e5;
}

body.theme-blue #sideMenu {
  background-color: #1565c0;
}
body.theme-blue #sideMenu hr {
  background-color: #64b5f6;
}

body.theme-blue #topRightLinks a {
  background-color: #1e88e5;
}
body.theme-blue #topRightLinks a:hover {
  background-color: #1565c0;
}

body.theme-blue #noticeArea h2,
body.theme-blue #completeSection h2 {
  color: #1565c0;
}

/* ===== RED ===== */
body.theme-red { background-color: #ffebee; }
body.theme-red h1 { color: #e53935; }

body.theme-red #scheduleTableRooms th,
body.theme-red #scheduleTableBeds th {
  background-color: #ef9a9a;
}

body.theme-red button {
  background-color: #e57373;
}
body.theme-red button:hover {
  background-color: #e53935;
}

body.theme-red #sideMenu {
  background-color: #b71c1c;
}
body.theme-red #sideMenu hr {
  background-color: #ef9a9a;
}

body.theme-red #topRightLinks a {
  background-color: #e53935;
}
body.theme-red #topRightLinks a:hover {
  background-color: #b71c1c;
}

body.theme-red #noticeArea h2,
body.theme-red #completeSection h2 {
  color: #b71c1c;
}

/* ===== YELLOW ===== */
body.theme-yellow { background-color: #fffde7; }
body.theme-yellow h1 { color: #f9a825; }

body.theme-yellow #scheduleTableRooms th,
body.theme-yellow #scheduleTableBeds th {
  background-color: #ffe082;
}

body.theme-yellow button {
  background-color: #ffd54f;
}
body.theme-yellow button:hover {
  background-color: #fbc02d;
}

body.theme-yellow #sideMenu {
  background-color: #f9a825;
}
body.theme-yellow #sideMenu hr {
  background-color: #ffe082;
}

body.theme-yellow #topRightLinks a {
  background-color: #f9a825;
}
body.theme-yellow #topRightLinks a:hover {
  background-color: #f57f17;
}

body.theme-yellow #noticeArea h2,
body.theme-yellow #completeSection h2 {
  color: #f57f17;
}

/* ãƒ†ãƒ¼ãƒé¸æŠãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ï¼ˆã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†…ï¼‰ */
#themeSelector {
  margin: 8px 0 4px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
#themeSelector .theme-btn {
  flex: 1 1 48%;
  font-size: 12px;
  padding: 6px 8px;
}
#themeSelector .theme-btn.is-active {
  outline: 2px solid #fff;
  box-shadow: 0 0 0 2px rgba(255,255,255,0.7);
}

@media (max-width: 480px) {
  #themeSelector .theme-btn {
    font-size: 10px;
    padding: 4px 6px;
  }
}


  </style>
</head>

<body class="theme-green">

<!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒœã‚¿ãƒ³ -->
<div id="menuButton">
  <i class="fas fa-bars fa-2x"></i>
</div>


<!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ï¼‰ -->
<div id="menuOverlay" class="hidden"></div>

<!-- ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼æœ¬ä½“ -->
<div id="sideMenu">
  <div style="margin-bottom: 20px; font-weight: bold; font-size: 18px;">YHASNæ–½è¨­äºˆç´„</div>

    <div class="menu-user">
    <img id="profileImage" src="" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" style="display:none; width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">
    <div id="menuUserName" style="font-size: 14px; font-weight: bold;"></div>
    <div id="menuUserEmail" style="font-size: 12px;"></div>
  </div>


   <div id="displayName" style="font-size: 16px;"></div>
  <div id="displayEmail" style="font-size: 12px;"></div>

  <!-- ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼é¸æŠ -->
  <div style="margin-top: 12px; font-size: 13px; font-weight: bold;">ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼</div>
  <div id="themeSelector">
    <button type="button" class="theme-btn" data-theme="green">ã‚°ãƒªãƒ¼ãƒ³</button>
    <button type="button" class="theme-btn" data-theme="blue">ãƒ–ãƒ«ãƒ¼</button>
    <button type="button" class="theme-btn" data-theme="red">ãƒ¬ãƒƒãƒ‰</button>
    <button type="button" class="theme-btn" data-theme="yellow">ã‚¤ã‚¨ãƒ­ãƒ¼</button>
  </div>

  <hr style="margin: 12px 0;">
  <button id="toCancelButton">ã‚ãªãŸã®äºˆç´„ï¼ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
<button id="sideLoginButton" style="display: none;">ãƒ­ã‚°ã‚¤ãƒ³</button>
<button id="sideLogoutButton" style="display: none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

  
</div>
  

  <div class="container">
    <h1>YHASNæ–½è¨­äºˆç´„</h1>

<!-- â–¼ è¿½è¨˜ï¼šãŠçŸ¥ã‚‰ã›ï¼ˆæ²ç¤ºæ¿è¡¨ç¤ºï¼‰ -->
<section id="noticeArea" style="max-width:980px;margin:0 auto 16px;background:#ffffff;border:1px solid #e0e0e0;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.06);">
  <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #eee;">
    <h2 style="margin:0;font-size:18px;color:#2e7d32;">ãŠçŸ¥ã‚‰ã›</h2>
    <button id="noticeReloadBtn" style="border:none;background:#43a047;color:#fff;border-radius:999px;padding:6px 10px;cursor:pointer;">æ›´æ–°</button>
  </div>
  <div id="noticeListStudent" style="padding:10px 14px;">
    <div style="color:#777;">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
  </div>
</section>


  <button type="button" id="loginButton">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦äºˆç´„ã™ã‚‹</button>
  

  

    <div id="dateControls">
      <button type="button" id="prevDayBtn">ï¼œ å‰ã®æ—¥</button>
      <label id="dateLabel"><input type="text" id="date" required></label>
      <button type="button" id="nextDayBtn">æ¬¡ã®æ—¥ ï¼</button>
    </div>



    <form id="reserveForm">
  <div id="selectedDateDisplay" style="text-align:center; font-size:22px; font-weight:bold; margin:20px 0;"></div>

      <div id="loading" style="display:none;"><i class="fas fa-spinner fa-spin"></i> èª­ã¿è¾¼ã¿ä¸­...</div>
  <h3>å­¦ç”Ÿæ¼”ç¿’å®¤ãƒ»äº¤æµå®¤</h3>
<div id="scheduleTableRooms"></div>

<h3>ãƒ™ãƒƒãƒ‰ï¼ˆ1ã€œ12ï¼‰</h3>
<div id="scheduleTableBeds"></div>

      <div id="reservationSection" style="display:none; margin-top:20px;">
        <h2>äºˆç´„ç¢ºèª</h2>
        <p id="selectedInfo"></p>
        <label>å­¦ç±ç•ªå·: <input type="text" id="studentId" required></label><br><br>
        <label>å­¦å¹´:
          <select id="grade" required>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="1å¹´">1å¹´</option>
            <option value="2å¹´">2å¹´</option>
            <option value="3å¹´">3å¹´</option>
          </select>
        </label><br><br>
        <label>åå‰: <input type="text" id="name" required></label><br><br>
        <button type="button" id="loginAndReserveButton">äºˆç´„ã™ã‚‹</button>
      </div>
      <div id="errorMsg"></div>
    </form>

    <div style="text-align:center; margin-top:20px;">
      
      <!-- â–¼ æ•™å®¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”»åƒè¡¨ç¤ºï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«å¯¾å¿œï¼‰ -->
<div class="image-section">
  <h2>æ¼”ç¿’å®¤ãƒ»äº¤æµå®¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</h2>
  <p style="font-size: 14px; color: #555;">â€»ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§</p>
<img id="imgEnsyuu" src="ensyuusitu2.jpg" alt="æ¼”ç¿’å®¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ">



  

  <h2>åŸºç¤çœ‹è­·å®Ÿç¿’å®¤ï¼ˆãƒ™ãƒƒãƒ‰1ã€œ12ï¼‰</h2>
  <p style="font-size: 14px; color: #555;">â€»ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§</p>
   <img id="imgBed"    src="bed2.jpg"       alt="ãƒ™ãƒƒãƒ‰é…ç½®å›³"> 
  
</div>
      
  

  <p id="userEmail" style="margin-top:10px;"></p>
</div>

<div id="completeSection" style="display:none; text-align:center; margin-top: 40px;">
  <h2>äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h2>
  <button id="backButton">äºˆç´„ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</button>
</div>

    

  </div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
<div id="modalEnsyuu" class="modal">
  <img src="ensyuusitu2.jpg" alt="æ¼”ç¿’å®¤æ‹¡å¤§">
</div>

<div id="modalBed" class="modal">
  <img src="bed2.jpg" alt="ãƒ™ãƒƒãƒ‰é…ç½®æ‹¡å¤§">
</div>




  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyCw6RzSw72t0BKoGjCONNPwz4plqn-74VY",
    authDomain: "yhasn-reserve.firebaseapp.com",
    projectId: "yhasn-reserve",
    storageBucket: "yhasn-reserve.appspot.com",
    messagingSenderId: "406712332925",
    appId: "1:406712332925:web:fb9253a313e4c76cfcb714"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

// ==== ç¥æ—¥è‡ªå‹•å–å¾—ï¼ˆholidays-jp GitHub JSON ã‚’åˆ©ç”¨ï¼‰ ====
// å‚è€ƒ: https://holidays-jp.github.io/
// å–å¾—ç¯„å›²ï¼šä»Šæ—¥ã€œ30æ—¥å¾Œã¾ã§ã«è·¨ã‚‹å¹´ï¼ˆæœ€å¤§ ç¾åœ¨å¹´/ç¿Œå¹´ã®2å¹´åˆ†ï¼‰

const HOLIDAY_API = (year) => `https://holidays-jp.github.io/api/v1/${year}/date.json`;
const holidayStore = { loaded: {} }; // { '2025-01-01': 'å…ƒæ—¥', ... , loaded: {2025:true} }

function ymd(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, "0");
  const d = String(date.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

async function loadHolidaysForRange(startDate, endDate) {
  const y1 = startDate.getFullYear();
  const y2 = endDate.getFullYear();
  const years = [];
  for (let y = y1; y <= y2; y++) {
    if (!holidayStore.loaded[y]) years.push(y);
  }
  if (years.length === 0) return;

  // å¹´ã”ã¨ã«å–å¾—ï¼ˆå¤±æ•—ã—ã¦ã‚‚å‡¦ç†ã¯ç¶šã‘ã‚‹ï¼‰
  await Promise.all(years.map(async (y) => {
    try {
      const res = await fetch(HOLIDAY_API(y), { cache: "no-store" });
      if (!res.ok) throw new Error(`fetch ${y} failed`);
      const data = await res.json(); // { "2025-01-01": "å…ƒæ—¥", ... }
      Object.keys(data).forEach(k => { holidayStore[k] = data[k]; });
      holidayStore.loaded[y] = true;
    } catch (e) {
      console.warn("ç¥æ—¥ã®å–å¾—ã«å¤±æ•—:", y, e);
      // å¤±æ•—æ™‚ã¯ loaded ãƒ•ãƒ©ã‚°ã®ã¿ç«‹ã¦ãªã„ï¼ˆæ¬¡å›å†è©¦è¡Œã§ãã‚‹ã‚ˆã†ã«ï¼‰
    }
  }));
}

// ç¥æ—¥åˆ¤å®šï¼ˆå–å¾—ã§ãã¦ã„ãªã„å¹´ã¯ false æ‰±ã„ï¼‰
function isHoliday(dateLike) {
  const d = (dateLike instanceof Date) ? dateLike : new Date(dateLike);
  return !!holidayStore[ymd(d)];
}




// ==== å­¦ç”Ÿå‘ã‘ãŠçŸ¥ã‚‰ã›è¡¨ç¤ºï¼ˆè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åˆ©ç”¨ç‰ˆï¼‰ ====
// ã‚¯ã‚¨ãƒªï¼šwhere(public==true).orderBy(pinned,'desc').orderBy(createdAt,'desc').limit(5)

function escapeHtml(str){
  return String(str || '').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}

function renderNoticeItem(d){
  const created = d.createdAt && d.createdAt.toDate ? d.createdAt.toDate() : null;
  const dateStr = created
    ? `${created.getFullYear()}-${String(created.getMonth()+1).padStart(2,'0')}-${String(created.getDate()).padStart(2,'0')}`
    : '';
  const pin = d.pinned ? 'ğŸ“Œ ' : '';
  const title = escapeHtml(d.title || '');
  const body  = d.body ? `<div style="white-space:pre-wrap;color:#333;margin-top:4px;">${escapeHtml(d.body)}</div>` : '';
  return `
    <article style="padding:10px 0;border-bottom:1px solid #eee;">
      <div style="font-weight:700;color:#1b5e20;">${pin}${title}</div>
      ${body}
      <div style="font-size:12px;color:#777;margin-top:4px;">${dateStr}</div>
    </article>
  `;
}

function loadNoticesForStudent(){
  const box = document.getElementById('noticeListStudent');
  if (!box) return;
  box.innerHTML = `<div style="color:#777;">èª­ã¿è¾¼ã¿ä¸­â€¦</div>`;

  db.collection('notices')
    .where('public','==', true)
    .orderBy('pinned','desc')
    .orderBy('createdAt','desc')
    .limit(5)
    .get()
    .then(snap => {
      if (snap.empty) {
        box.innerHTML = `<div style="color:#777;">ç¾åœ¨ã€ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
        return;
      }
      let html = '';
      snap.forEach(doc => { html += renderNoticeItem(doc.data() || {}); });
      box.innerHTML = html;
    })
    .catch(e => {
      // ã“ã“ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸è¶³ç­‰ã®å…·ä½“ã‚¨ãƒ©ãƒ¼ãŒè¦‹ãˆã‚‹
      box.innerHTML = `<div style="color:#c62828;">ãŠçŸ¥ã‚‰ã›ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${escapeHtml(e.message || String(e))}</div>`;
      console.warn('loadNoticesForStudent error:', e);
    });
}

// åˆæœŸè¡¨ç¤ºï¼‹æ‰‹å‹•æ›´æ–°
document.addEventListener('DOMContentLoaded', loadNoticesForStudent);
document.getElementById('noticeReloadBtn')?.addEventListener('click', loadNoticesForStudent);




  // â† ã“ã“ã‹ã‚‰è¿½è¨˜ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿æŒã‚’æ˜ç¤ºï¼ˆæ—¢å®šã‚‚LOCALã ãŒæ˜æ–‡åŒ–ï¼‰
firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).catch(console.warn);
// ã“ã“ã¾ã§è¿½è¨˜ â†’


// â˜…â˜…â˜… ã“ã“ã‹ã‚‰è¿½è¨˜ï¼ˆdb å®šç¾©ã®ç›´å¾Œã«å…¥ã‚Œã‚‹ï¼‰â˜…â˜…â˜…
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwBztqWNBpozNAL9S10_K44z4T5l8vIv7a7s3SyjI1W7zZhvdhLfaZVeLNVSBvcxIQ06A/exec'; // ã‚ãªãŸã®GAS Webã‚¢ãƒ—ãƒªURL
const SHARED_SECRET = 'yhasn_2025jichikai_reservation_sending-email';                   // GASå´ã¨åŒã˜ç§˜å¯†æ–‡å­—åˆ—

async function sendMailForReservation({ to, dateText, timeText, roomText, roomSaved, studentId, studentName, grade }) {
  const subject = `äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼š${dateText} ${timeText} ${roomText}`;
  const html = `
    <div style="font-family:'Noto Sans JP',sans-serif; line-height:1.7;">
      <p>${studentName || 'åˆ©ç”¨è€…'} ã•ã‚“</p>
      <p>ä»¥ä¸‹ã®å†…å®¹ã§äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚</p>
      <table style="border-collapse:collapse;">
        <tr><td style="padding:4px 8px;">æ—¥ä»˜</td><td style="padding:4px 8px;">${dateText}</td></tr>
        <tr><td style="padding:4px 8px;">æ™‚é–“</td><td style="padding:4px 8px;">${timeText}</td></tr>
        <tr><td style="padding:4px 8px;">ãƒ™ãƒƒãƒ‰/éƒ¨å±‹</td><td style="padding:4px 8px;">${roomText}</td></tr>
        <tr><td style="padding:4px 8px;">å­¦ç±ç•ªå·</td><td style="padding:4px 8px;">${studentId}</td></tr>
        <tr><td style="padding:4px 8px;">æ°å</td><td style="padding:4px 8px;">${studentName}</td></tr>
        <tr><td style="padding:4px 8px;">å­¦å¹´</td><td style="padding:4px 8px;">${grade}</td></tr>
      </table>
      <p>â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯é€ä¿¡å°‚ç”¨ã§ã™ã€‚</p>
    </div>
  `;
  try {
        // CORSãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆå›é¿ã®ãŸã‚ Content-Type ã‚’ text/plain ã«
    // å¿œç­”ã¯èª­ã¾ãªã„ï¼ˆGASã¯CORSãƒ˜ãƒƒãƒ€ã‚’ä»˜ã‘ã‚‰ã‚Œãªã„ãŸã‚ï¼‰
    await fetch(GAS_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify({
        secret: SHARED_SECRET,
        to,
        subject,
        html,
        origin: location.origin   // â† GASå´ã§ALLOW_FROMãƒã‚§ãƒƒã‚¯ã«ä½¿ã†ãªã‚‰ãã®ã¾ã¾
      })
    }).catch((e) => {
      console.warn('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯)', e);
    });

  } catch (e) {
    console.warn('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯)', e);
  }
}

// â˜…â˜…â˜… è¿½è¨˜ã“ã“ã¾ã§ â˜…â˜…â˜…

// ===== ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼é–¢é€£ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ä¿å­˜ï¼‰ =====
function markThemeButton(theme) {
  const buttons = document.querySelectorAll("#themeSelector .theme-btn");
  buttons.forEach(btn => {
    const isActive = btn.dataset.theme === theme;
    btn.classList.toggle("is-active", isActive);
  });
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ†ãƒ¼ãƒèª­ã¿è¾¼ã¿
async function loadThemeForUser(user) {
  try {
    if (!user) {
      // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆã‚°ãƒªãƒ¼ãƒ³ï¼‰
      applyTheme("green");
      return;
    }
    const snap = await db.collection("userSettings").doc(user.uid).get();
    const theme = snap.exists && snap.data().theme ? snap.data().theme : "green";
    applyTheme(theme);
  } catch (e) {
    console.warn("ãƒ†ãƒ¼ãƒèª­ã¿è¾¼ã¿ã«å¤±æ•—", e);
    applyTheme("green");
  }
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ†ãƒ¼ãƒä¿å­˜
async function saveThemeForUser(theme) {
  const user = firebase.auth().currentUser;
  if (!user) return;
  try {
    await db.collection("userSettings").doc(user.uid).set(
      { theme },
      { merge: true }
    );
  } catch (e) {
    console.warn("ãƒ†ãƒ¼ãƒä¿å­˜ã«å¤±æ•—", e);
  }
}

// å®Ÿéš›ã« class ã‚’ä»˜ã‘æ›¿ãˆã‚‹
function applyTheme(theme) {
  const body = document.body;
  const themes = ["green", "blue", "red", "yellow"];
  if (!themes.includes(theme)) theme = "green";

  themes.forEach(t => body.classList.remove(`theme-${t}`));
  body.classList.add(`theme-${theme}`);
  markThemeButton(theme);
}


  let currentUser = null;

firebase.auth().onAuthStateChanged(user => {
  currentUser = user;
  // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ†ãƒ¼ãƒã‚’åæ˜ 
  loadThemeForUser(user);

  const nameDiv   = document.getElementById("menuUserName");
  const emailDiv  = document.getElementById("menuUserEmail");
  const img       = document.getElementById("profileImage");
  const sideLoginBtn  = document.getElementById("sideLoginButton");
  const sideLogoutBtn = document.getElementById("sideLogoutButton");

  const loginBtn  = document.getElementById("loginButton");
  const logoutBtn = document.getElementById("logoutButton");
  const userEmail = document.getElementById("userEmail");
  const reserveSection = document.getElementById("reservationSection");

  if (user) {
    // ===== ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®è¡¨ç¤ºæ›´æ–° =====
    const fullName = user.displayName || "";
    const email    = user.email || "";
    const photoURL = user.photoURL || "";

    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º
    if (nameDiv)  nameDiv.textContent  = fullName;
    if (emailDiv) emailDiv.textContent = `${email} ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­`;
    if (img) {
      if (photoURL) {
        img.src = photoURL;
      } else {
        img.removeAttribute("src");
      }
      img.style.display = "block";
    }

    // å…¥åŠ›æ¬„ã®è‡ªå‹•å…¥åŠ›ï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¸è¥²ï¼‰
    const studentIdFromEmail = email.split("@")[0];
    let combinedName = fullName;
    if (fullName.includes(" ")) {
      const parts = fullName.split(" ");
      const familyPart = parts[0];
      const firstName  = parts[1];
      const nameWithoutStudentId = familyPart.replace(/[AB]\d{6}/, "");
      combinedName = `${nameWithoutStudentId} ${firstName}`;
    }
    const studentIdInput = document.getElementById("studentId");
    const nameInput      = document.getElementById("name");
    if (studentIdInput) studentIdInput.value = studentIdFromEmail;
    if (nameInput)      nameInput.value      = combinedName;

    // ãƒœã‚¿ãƒ³è¡¨ç¤º
    if (sideLoginBtn)  sideLoginBtn.style.display  = "none";
    if (sideLogoutBtn) sideLogoutBtn.style.display = "inline-block";
    if (loginBtn)  loginBtn.style.display  = "none";
    if (logoutBtn) logoutBtn.style.display = "inline-block";
    if (userEmail) userEmail.textContent   = "ãƒ­ã‚°ã‚¤ãƒ³ä¸­: " + email;
    if (reserveSection) reserveSection.style.display = "block";

  } else {
    // ===== ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã¯å¿…ãšç©ºã¸ =====
    if (nameDiv)  nameDiv.textContent = "";
    if (emailDiv) emailDiv.textContent = "";
    if (img) {
      img.style.display = "none";
      img.removeAttribute("src");
    }

    // ãƒœã‚¿ãƒ³è¡¨ç¤º
    if (sideLoginBtn)  sideLoginBtn.style.display  = "inline-block";
    if (sideLogoutBtn) sideLogoutBtn.style.display = "none";
    if (loginBtn)  loginBtn.style.display  = "inline-block";
    if (logoutBtn) logoutBtn.style.display = "none";
    if (userEmail) userEmail.textContent   = "";
    if (reserveSection) reserveSection.style.display = "none";
  }

  // ğŸ” çŠ¶æ…‹å¤‰åŒ–ã«å¿œã˜ã¦è¡¨ã‚’å†æç”»
  if (selectedDate) {
    loadSchedule(selectedDate);
  }
});


 

  const rooms = [
    "å­¦ç”Ÿæ¼”ç¿’å®¤1", "å­¦ç”Ÿæ¼”ç¿’å®¤2", "å­¦ç”Ÿæ¼”ç¿’å®¤3", "å­¦ç”Ÿæ¼”ç¿’å®¤4", "å­¦ç”Ÿæ¼”ç¿’å®¤5",
    "äº¤æµå®¤", "ãƒ™ãƒƒãƒ‰1", "ãƒ™ãƒƒãƒ‰2", "ãƒ™ãƒƒãƒ‰3", "ãƒ™ãƒƒãƒ‰4", "ãƒ™ãƒƒãƒ‰5", "ãƒ™ãƒƒãƒ‰6",
    "ãƒ™ãƒƒãƒ‰7", "ãƒ™ãƒƒãƒ‰8", "ãƒ™ãƒƒãƒ‰9", "ãƒ™ãƒƒãƒ‰10", "ãƒ™ãƒƒãƒ‰11", "ãƒ™ãƒƒãƒ‰12"
  ];
   
  const times = [
  { label: "08:30-09:00", value: "08:30-09:00" },
  { label: "09:00-10:40<br>ï¼ˆï¼‘é™ï¼‰", value: "09:00-10:40(1é™)" },
  { label: "10:40-12:10<br>ï¼ˆï¼’é™ï¼‰", value: "10:40-12:10(2é™)" },
  { label: "12:10-13:20<br>ï¼ˆæ˜¼ä¼‘ã¿ï¼‰", value: "12:10-13:20(æ˜¼ä¼‘ã¿)" },
  { label: "13:20-15:00<br>ï¼ˆï¼“é™ï¼‰", value: "13:20-15:00(3é™)" },
  { label: "15:00-16:30<br>ï¼ˆï¼”é™ï¼‰", value: "15:00-16:30(4é™)" },
  { label: "16:30-18:00", value: "16:30-18:00" },
  { label: "18:00-20:00", value: "18:00-20:00" }
];

  let selectedDate = "";
  let selectedRoom = "";
  let selectedTime = "";
  let datePicker;

  function formatDate(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, "0");
    const d = String(date.getDate()).padStart(2, "0");
    return `${y}-${m}-${d}`;
  }

  function formatDisplayDate(dateStr) {
  const date = new Date(dateStr);
  const weekdays = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
  const y = date.getFullYear();
  const m = date.getMonth() + 1;
  const d = date.getDate()
  const w = weekdays[date.getDay()];
  return `${y}å¹´${m}æœˆ${d}æ—¥ï¼ˆ${w}ï¼‰`;
}

function getNextValidDate(date, step) {
  const newDate = new Date(date);
  const maxDate = new Date(); // ä»Šæ—¥
  maxDate.setDate(maxDate.getDate() + 30); // 1ãƒ¶æœˆå¾Œ

  while (true) {
    newDate.setDate(newDate.getDate() + step);
    const formatted = formatDate(newDate);

    // âœ… ä¸Šé™ãƒã‚§ãƒƒã‚¯ï¼ˆstep > 0ã®ã¨ãï¼‰
    if (step > 0 && newDate > maxDate) return formatDate(maxDate);

    // âœ… ä¸‹é™ãƒã‚§ãƒƒã‚¯ï¼ˆstep < 0ã®ã¨ãï¼‰
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    if (step < 0 && newDate < today) return formatDate(today);

    if (newDate.getDay() !== 0 && newDate.getDay() !== 6 && !isHoliday(newDate)) {
  return formatted;
}

  }
}

function loadSchedule(date) {
  selectedDate = date;
  document.getElementById("selectedDateDisplay").textContent = formatDisplayDate(date);
  if (datePicker) {
    datePicker.setDate(date);
  }

  // ã€Œå‰ã®æ—¥ã€ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
  const today = formatDate(new Date());
  const prevBtn = document.getElementById("prevDayBtn");
  if (prevBtn) {
    const isToday = (date === today);

    // âœ¨ å½“æ—¥ã¯ã€Œè¦‹ãˆãªã„ã‘ã©å¹…ã¯æ®‹ã™ã€â†’ æ—¥ä»˜ã¯ã©çœŸã‚“ä¸­ã®ã¾ã¾
    prevBtn.style.visibility = isToday ? "hidden" : "visible";
    prevBtn.disabled = isToday; // å¿µã®ãŸã‚ã‚¯ãƒªãƒƒã‚¯ã‚‚ç„¡åŠ¹åŒ–
  }

   const loading = document.getElementById("loading");
document.getElementById("scheduleTableRooms").innerHTML = "";
document.getElementById("scheduleTableBeds").innerHTML = "";
    loading.style.display = "block";

    const roomTimeStatus = {};
    const promises = [];

    times.forEach(time => {
  const timeVal = time.value;  // â† ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
  roomTimeStatus[timeVal] = {};  // â† ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªãæ–‡å­—åˆ—ã‚­ãƒ¼ã‚’ä½¿ç”¨

  rooms.forEach(room => {
  roomTimeStatus[timeVal][room] = null;

  let roomKeyForQuery = room;
  if (room.startsWith("ãƒ™ãƒƒãƒ‰")) {
    const num = room.replace("ãƒ™ãƒƒãƒ‰", "");
    roomKeyForQuery = "ãƒ™ãƒƒãƒ‰" + num.padStart(2, "0");
  }

  const query = db.collection("reservations")
    .where("date", "==", date)
    .where("time", "==", timeVal)
    .where("room", "==", roomKeyForQuery);

  promises.push(query.get().then(snapshot => {
      if (!snapshot.empty) {
        const data = snapshot.docs[0].data();
        roomTimeStatus[timeVal][room] = {
          name: data.name || ""
        };
      }
    }));
  });
});

    Promise.all(promises).then(() => {
      renderSchedule(roomTimeStatus);
      loading.style.display = "none";
    });
  }

  function renderSchedule(status) {
  const scheduleTableRooms = document.getElementById("scheduleTableRooms");
  const scheduleTableBeds = document.getElementById("scheduleTableBeds");
  scheduleTableRooms.innerHTML = "";
  scheduleTableBeds.innerHTML = "";

  const roomGroup1 = rooms.filter(r => r.includes("æ¼”ç¿’å®¤") || r.includes("äº¤æµå®¤"));
  const roomGroup2 = rooms.filter(r => r.includes("ãƒ™ãƒƒãƒ‰"));

  function generateTable(roomsSubset) {
    let html = "<table><thead><tr><th>æ™‚é–“å¸¯</th>";
    roomsSubset.forEach(room => {
      html += `<th>${room}</th>`;
    });
    html += "</tr></thead><tbody>";

    // ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç”Ÿæˆéƒ¨åˆ†
times.forEach(timeObj => {
  html += `<tr><th>${timeObj.label}</th>`;
   roomsSubset.forEach(room => {
    const timeVal = timeObj.value;

    // ç”»é¢ç”¨ã®ã‚­ãƒ¼ï¼ˆroom ãã®ã¾ã¾ï¼‰ã§å‚ç…§ã™ã‚‹
    const cellStatus = status[timeVal][room];

    if (cellStatus) {
      html += `<td class="disabled">${cellStatus.name || '<i class="fas fa-times"></i>'}</td>`;
    } else {
      html += `<td class="available" data-room="${room}" data-time="${timeVal}"><i class="fas fa-circle"></i></td>`;
    }
  });

  html += "</tr>";
});

    html += "</tbody></table>";
    return html;
  }

  scheduleTableRooms.innerHTML = generateTable(roomGroup1);
  scheduleTableBeds.innerHTML = generateTable(roomGroup2);

  const user = firebase.auth().currentUser;
  document.querySelectorAll("td.available").forEach(cell => {
    cell.style.cursor = user ? "pointer" : "default";
  });

  function handleSelection(cell) {
  selectedRoom = cell.dataset.room;
  selectedTime = cell.dataset.time;
  document.getElementById("selectedInfo").textContent = `ã€${formatDisplayDate(selectedDate)}ã€‘ ${selectedTime} - ${selectedRoom}`;
}

  document.querySelectorAll("td.available").forEach(cell => {
    cell.classList.remove("clickable");
    cell.removeEventListener("click", cell._clickHandler);

    if (firebase.auth().currentUser) {
      cell.classList.add("clickable");
      cell._clickHandler = () => {
  document.querySelectorAll("td.available.selected").forEach(c => c.classList.remove("selected"));
  // ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚’ç¢ºå®Ÿã«ç™ºç«ã•ã›ã‚‹ãŸã‚ã€1ãƒ•ãƒ¬ãƒ¼ãƒ é…ã‚‰ã›ã¦ä»˜ä¸
  requestAnimationFrame(() => {
    cell.classList.add("selected");
    handleSelection(cell);
    document.getElementById("reservationSection").style.display = "block";
  });
};

      cell.addEventListener("click", cell._clickHandler);
    } else {
      cell._clickHandler = null;
      cell.style.pointerEvents = "none";
    }
  });
    // === è¿½è¨˜ï¼šç©ºå®¤ã‚»ãƒ«ã®ã‚¿ãƒƒãƒ—å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆãƒ¢ãƒã‚¤ãƒ«ä½“æ„Ÿå‘ä¸Šï¼‰ ===
  (function bindFastTapOnce() {
    const roots = [
      document.getElementById("scheduleTableRooms"),
      document.getElementById("scheduleTableBeds")
    ];
    roots.forEach(root => {
      if (!root || root._fastTapBound) return;

      // æŠ¼ã—ãŸç¬é–“ã«è¦–è¦šã ã‘å…ˆã«åæ˜ 
      root.addEventListener("pointerdown", (e) => {
        const td = e.target.closest && e.target.closest("td.available");
        if (!td) return;
        td.classList.add("tap-active");
      }, { passive: true });

      // é›¢ã—ãŸã‚‰å°‘ã—é…ã‚‰ã›ã¦å…ƒã«æˆ»ã™ï¼ˆæŠ¼ä¸‹æ„Ÿã®ä½™éŸ»ï¼‰
      const clearActive = (e) => {
        const td = (e && e.target && e.target.closest) ? e.target.closest("td.available") : null;
        if (td) setTimeout(() => td.classList.remove("tap-active"), 80);
      };
      root.addEventListener("pointerup", clearActive,     { passive: true });
      root.addEventListener("pointercancel", clearActive, { passive: true });
      root.addEventListener("pointerleave", clearActive,  { passive: true });

      // äºŒé‡ãƒã‚¤ãƒ³ãƒ‰é˜²æ­¢
      root._fastTapBound = true;
    });
  })();

}

  document.addEventListener("DOMContentLoaded", () => {
    const menuBtn     = document.getElementById("menuButton");
const sideMenu    = document.getElementById("sideMenu");
const menuOverlay = document.getElementById("menuOverlay");

(async () => {
  // ç¥æ—¥ã‚’å…ˆã«ãƒ­ãƒ¼ãƒ‰ï¼ˆä»Šæ—¥ã€œ30æ—¥å¾Œã¾ã§ã®å¹´ï¼‰
  const today = new Date();
  const end   = new Date();
  end.setDate(end.getDate() + 30);
  await loadHolidaysForRange(today, end);

  // ç¥æ—¥/é€±æœ«ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
  datePicker = flatpickr("#date", {
    dateFormat: "Y-m-d",
    minDate: "today",
    maxDate: new Date().fp_incr(30),
    disable: [
      date => {
        const wd = date.getDay();
        return wd === 0 || wd === 6 || isHoliday(date);
      }
    ],
    locale: "ja",
    allowInput: false,
    onChange: (selectedDates) => {
      if (selectedDates.length > 0) {
        const d = ymd(selectedDates[0]);
        loadSchedule(d);
      }
    }
  });

  // åˆæœŸè¡¨ç¤ºæ—¥ï¼ˆä»Šæ—¥ãŒåœŸæ—¥ç¥ãªã‚‰ç›´è¿‘ã®å¹³æ—¥ã«ã‚·ãƒ•ãƒˆï¼‰
  function findInitialDate(startDate) {
    let d = new Date(startDate);
    while (d.getDay() === 0 || d.getDay() === 6 || isHoliday(d)) {
      d.setDate(d.getDate() + 1);
    }
    return ymd(d);
  }
  selectedDate = findInitialDate(new Date());
  loadSchedule(selectedDate);
})();


     


   // å…±é€šï¼šå³æ™‚ã‚¿ãƒƒãƒ—ï¼†ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¯¾å¿œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
function fastOn(el, handler) {
  // pointerup ã§å³æ™‚ç™ºç«ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã® click é…å»¶å›é¿ï¼‰
  el.addEventListener("pointerup", (ev) => {
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ»ãƒ‰ãƒ©ãƒƒã‚°èª¤çˆ†ã‚’è»½æ¸›
    if (Math.abs(ev.pointerType === 'touch' ? ev.width : 0) > 100) return;
    handler(ev);
  }, { passive: true });

  // Enter/Space ã§ã‚‚æ“ä½œã§ãã‚‹ã‚ˆã†ã«ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
  el.addEventListener("keydown", (ev) => {
    if (ev.key === "Enter" || ev.key === " ") {
      ev.preventDefault();
      handler(ev);
    }
  });
}

// ãƒ†ãƒ¼ãƒãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
function setupThemeButtons() {
  const buttons = document.querySelectorAll("#themeSelector .theme-btn");
  if (!buttons.length) return;

  buttons.forEach(btn => {
    const theme = btn.dataset.theme;
    fastOn(btn, () => {
      applyTheme(theme);
      saveThemeForUser(theme);
    });
  });
}
setupThemeButtons();

// ---- ã€Œå‰ã®æ—¥ã€ã€Œæ¬¡ã®æ—¥ã€ ----
fastOn(document.getElementById("prevDayBtn"), () => {
  const date = new Date(selectedDate);
  const prev = getNextValidDate(date, -1);
  loadSchedule(prev);
});
fastOn(document.getElementById("nextDayBtn"), () => {
  const date = new Date(selectedDate);
  const next = getNextValidDate(date, 1);
  loadSchedule(next);
});

// ---- å®Œäº†ç”»é¢â†’æˆ»ã‚‹ ----
fastOn(document.getElementById("backButton"), () => {
  document.getElementById("completeSection").style.display = "none";
  document.getElementById("scheduleTableRooms").style.display = "block";
  document.getElementById("scheduleTableBeds").style.display = "block";
  document.getElementById("dateControls").style.display = "flex";
  // ğŸ¯äºˆç´„è¡¨è¦‹å‡ºã—ã¨ç”»åƒã‚‚å¾©æ´»
  document.querySelector(".image-section").style.display = "block";
  document.querySelector("h3").style.display = "block";
  document.querySelectorAll("h3")[1].style.display = "block";
  loadSchedule(selectedDate);
});

// ---- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ----
fastOn(menuBtn, () => {
  sideMenu.classList.add("visible");
  menuOverlay.classList.add("show");
});
fastOn(menuOverlay, () => {
  sideMenu.classList.remove("visible");
  menuOverlay.classList.remove("show");
});

// ---- ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ï¼‰ ----
// ===== ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼šå„ãƒœã‚¿ãƒ³ =====
fastOn(document.getElementById("toCancelButton"), () => {
  location.href = "cancel.html";
});
fastOn(document.getElementById("sideLoginButton"), () => {
  handleLogin();
});
fastOn(document.getElementById("sideLogoutButton"), () => {
  handleLogout();
});

// ===== ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ï¼ˆå®šç¾©æ¸ˆã¿ menuBtn / sideMenu / menuOverlay ã‚’ä½¿ç”¨ï¼‰=====
fastOn(menuBtn, () => {
  sideMenu.classList.add("visible");
  menuOverlay.classList.add("show");
});
fastOn(menuOverlay, () => {
  sideMenu.classList.remove("visible");
  menuOverlay.classList.remove("show");
});

// ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šé–‹ãï¼ˆç”»åƒã‚¿ãƒƒãƒ—ï¼‰=====
fastOn(document.getElementById("imgEnsyuu"), () => openModal("modalEnsyuu"));
fastOn(document.getElementById("imgBed"),    () => openModal("modalBed"));

// ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šé–‰ã˜ã‚‹ï¼ˆèƒŒæ™¯ã‚¿ãƒƒãƒ—ï¼‰=====
["modalEnsyuu", "modalBed"].forEach(id => {
  const m = document.getElementById(id);
  if (!m) return;
  fastOn(m, (ev) => {
    const t = ev.target;
    if (t && t.tagName && t.tagName.toLowerCase() === "img") return; // ç”»åƒã‚¿ãƒƒãƒ—ã¯é–‰ã˜ãªã„
    m.style.display = "none";
  });
});

fastOn(document.getElementById("loginButton"), async () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  provider.setCustomParameters({ prompt: 'select_account', hd: 'yhasn.ed.jp' });
  try {
    const result = await firebase.auth().signInWithPopup(provider);
    if (!result.user.email.endsWith("@yhasn.ed.jp")) {
      alert("å­¦æ ¡ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ@yhasn.ed.jpï¼‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
      await firebase.auth().signOut();
      return;
    }
    setTimeout(() => {
      if (firebase.auth().currentUser && selectedDate) loadSchedule(selectedDate);
    }, 100);
  } catch (e) {
    console.warn("signIn canceled or failed:", e);
  }
});

// ---- ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆé–‹ãå´ï¼‰ã‚‚å³æ™‚åŒ– ----
document.querySelectorAll(".image-section img").forEach(img => {
  img.style.cursor = "zoom-in";
  fastOn(img, () => {
    // æ—¢å­˜ã® onclick ã¨äºŒé‡ã«ãªã£ã¦ã‚‚æ‚ªå½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“
    // alt / ä½ç½®ã‹ã‚‰ ID ã‚’æ¨å®š
    if (img.src.includes("ensyuusitu2.jpg")) openModal("modalEnsyuu");
    else if (img.src.includes("bed2.jpg")) openModal("modalBed");
  });
});

// ---- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆé–‰ã˜ã‚‹å´ï¼‰ã‚‚å³æ™‚åŒ– ----
["modalEnsyuu", "modalBed"].forEach(id => {
  const m = document.getElementById(id);
  if (!m) return;
  fastOn(m, (ev) => {
    // ç”»åƒè‡ªä½“ã®ã‚¿ãƒƒãƒ—ã§ã¯é–‰ã˜ãªã„ï¼ˆæ—¢å­˜ä»•æ§˜è¸è¥²ï¼‰
    if (ev && ev.target && ev.target.tagName && ev.target.tagName.toLowerCase() === "img") return;
    m.style.display = "none";
  });
});

// ===== ã€Œäºˆç´„ã™ã‚‹ã€ãƒœã‚¿ãƒ³ï¼ˆå³æ™‚ã‚¿ãƒƒãƒ—ï¼‰ =====
{
  const btn = document.getElementById("loginAndReserveButton");
  if (btn) {
    function reserveHandler() {
      document.getElementById("errorMsg").textContent = "";

      const name      = document.getElementById("name").value.trim();
      const studentId = document.getElementById("studentId").value.trim();
      const grade     = document.getElementById("grade").value;

      if (!selectedDate || !selectedRoom || !selectedTime || !name || !studentId || !grade) {
        document.getElementById("errorMsg").textContent = "ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      const confirmMsg = `ä»¥ä¸‹ã®å†…å®¹ã§äºˆç´„ã—ã¾ã™ã‹ï¼Ÿ\n\n` +
        `æ—¥ä»˜ï¼š${formatDisplayDate(selectedDate)}\n` +
        `æ™‚é–“å¸¯ï¼š${selectedTime}\n` +
        `éƒ¨å±‹ï¼š${selectedRoom}\n` +
        `å­¦ç±ç•ªå·ï¼š${studentId}\n` +
        `å­¦å¹´ï¼š${grade}\n` +
        `åå‰ï¼š${name}`;
      if (!confirm(confirmMsg)) return;

      const user = firebase.auth().currentUser;
      if (!user) { alert("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚"); return; }
      if (!user.email.endsWith("@yhasn.ed.jp")) {
        alert("å­¦æ ¡ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ@yhasn.ed.jpï¼‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      const emailStudentId = user.email.split("@")[0].slice(0, 6);
      if (emailStudentId !== studentId) {
        alert("ä¸æ­£ãªå­¦ç±ç•ªå·ã§ã™ã€‚\næ­£ã—ã„å­¦ç±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      let roomToSave = selectedRoom;
      if (roomToSave.startsWith("ãƒ™ãƒƒãƒ‰")) {
        const padded = roomToSave.replace("ãƒ™ãƒƒãƒ‰","").padStart(2,"0");
        roomToSave = `ãƒ™ãƒƒãƒ‰${padded}`;
      }

      db.collection("reservations")
        .where("date", "==", selectedDate)
        .where("studentId", "==", studentId)
        .get()
.then(async (snapshot) => {
  if (!snapshot.empty) {
    alert("æ—¢ã«ã“ã®æ—¥ã«ã¯äºˆç´„ãŒã‚ã‚Šã¾ã™ã€‚\n1æ—¥ã«è¤‡æ•°ã®äºˆç´„ã¯ã§ãã¾ã›ã‚“ã€‚");
    return;
  }

  // --- åœæ­¢ä¸­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒã‚§ãƒƒã‚¯ ---
  const suspendRef = db.collection("suspendedUsers").doc(studentId);
  const suspendSnap = await suspendRef.get();
  if (suspendSnap.exists) {
    alert(`ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯åœæ­¢ä¸­ã§ã™ã€‚\nè©³ç´°ã¯ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚`);
    return; // äºˆç´„å‡¦ç†ã‚’ä¸­æ­¢
  }
  
  // --- å­¦å¹´ãƒ»å­¦ç±ç•ªå·ã«ã‚ˆã‚‹ä¸€æ™‚åˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆ2026-01-01ã€œ2026-02-15ï¼‰---
const startLimit = new Date("2026-01-01");
const endLimit   = new Date("2026-02-15");
const currentDate = new Date(selectedDate);

const isWithinLimitPeriod = currentDate >= startLimit && currentDate <= endLimit;
const isTargetRoom = ["å­¦ç”Ÿæ¼”ç¿’å®¤2", "å­¦ç”Ÿæ¼”ç¿’å®¤3", "å­¦ç”Ÿæ¼”ç¿’å®¤4", "å­¦ç”Ÿæ¼”ç¿’å®¤5"].includes(selectedRoom);

if (isWithinLimitPeriod && isTargetRoom) {
  // å­¦ç±ç•ªå·ã®å…ˆé ­2æ¡
  const studentPrefix = studentId.slice(0, 2);
  // å­¦å¹´ï¼ˆæ•°å€¤åŒ–ï¼‰
  const gradeNum = grade.replace("å¹´", "");

  if (["24", "25"].includes(studentPrefix) || ["1", "2"].includes(gradeNum)) {
    alert(`ï¼ˆ2026/1/1ã€œ2/15ï¼‰ã¯ã€3å¹´ç”Ÿã®ã¿å­¦ç”Ÿæ¼”ç¿’å®¤2ã€œ5ã‚’äºˆç´„ã§ãã¾ã™ã€‚\nä»–ã®æ•™å®¤ã¾ãŸã¯æœŸé–“å¤–ã®æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚`);
    return; // äºˆç´„ä¸­æ­¢
  }
}
  

  // --- é€šå¸¸ã®äºˆç´„å‡¦ç†ç¶šè¡Œ ---
  return db.collection("reservations").add({
    room: roomToSave,
    date: selectedDate,
    time: selectedTime,
    name,
    studentId,
    grade,
    email: user.email,
    createdAt: new Date()
  }).then(() => {
    // æ—¢å­˜ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    sendMailForReservation({
      to: user.email,
      dateText: selectedDate,
      timeText: selectedTime,
      roomText: selectedRoom,
      roomSaved: roomToSave,
      studentId,
      studentName: name,
      grade
    });

    // å®Œäº†ç”»é¢è¡¨ç¤ºï¼ˆæ—¢å­˜UIåˆ‡æ›¿ï¼‰
    document.getElementById("reservationSection").style.display = "none";
    document.getElementById("dateControls").style.display = "none";
    document.getElementById("scheduleTableRooms").style.display = "none";
    document.getElementById("scheduleTableBeds").style.display = "none";
    document.querySelector(".image-section").style.display = "none";
    document.querySelector("h3").style.display = "none";
    document.querySelectorAll("h3")[1].style.display = "none";
    document.getElementById("completeSection").style.display = "block";
    document.getElementById("errorMsg").textContent = "";
  });
}).catch(error => {
          console.error("äºˆç´„ã‚¨ãƒ©ãƒ¼:", error);
          document.getElementById("errorMsg").textContent = "äºˆç´„ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚";
        });
    }

    // ã“ã“ã¯DOMå†…ãªã®ã§ fastOn ãŒä½¿ãˆã‚‹
    fastOn(btn, reserveHandler);
  }
}



  });

  



function openModal(id) {
  document.getElementById(id).style.display = "flex";
}

function closeModal(event, id) {
  // ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã¯é–‰ã˜ãªã„ã‚ˆã†ã«ã™ã‚‹
  if (event.target.tagName.toLowerCase() === 'img') return;
  document.getElementById(id).style.display = "none";
}


function handleLogin() {
  const provider = new firebase.auth.GoogleAuthProvider();
  provider.setCustomParameters({
    prompt: 'select_account',  // â† å¸¸ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠã‚’å¼·åˆ¶
    hd: 'yhasn.ed.jp'
  });

  firebase.auth().signInWithPopup(provider).then(async (result) => {
    const user = result.user;

    // æœ€çµ‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (!user.email.endsWith("@yhasn.ed.jp")) {
      alert("å­¦æ ¡ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ@yhasn.ed.jpï¼‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
      await firebase.auth().signOut();
      return;
    }

    // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
    document.getElementById("sideMenu").classList.remove("visible");
    document.getElementById("menuOverlay").classList.remove("show");

    // åæ˜ å¾…ã¡ã®å¾Œã€è¡¨ã‚’å†æç”»
    setTimeout(() => {
      if (firebase.auth().currentUser && selectedDate) {
        loadSchedule(selectedDate);
      }
    }, 100);

    // çŠ¶æ…‹å¤‰åŒ–ã‚’ä¸€åº¦ã ã‘æ‹¾ã£ã¦å†æç”»
    const unsubscribe = firebase.auth().onAuthStateChanged(newUser => {
      if (newUser) {
        if (selectedDate) loadSchedule(selectedDate);
        unsubscribe();
      }
    });

  }).catch((e) => {
    console.warn("signIn canceled or failed:", e);
  });
}



function handleLogout() {
  // 1) ã¾ãšå³æ™‚ã«UIã‚’ã‚¯ãƒªã‚¢ï¼ˆonAuthStateChanged ã‚’å¾…ãŸãšã«æ¶ˆã™ï¼‰
  const nameDiv   = document.getElementById("menuUserName");
  const emailDiv  = document.getElementById("menuUserEmail");
  const img       = document.getElementById("profileImage");
  const sideLoginBtn  = document.getElementById("sideLoginButton");
  const sideLogoutBtn = document.getElementById("sideLogoutButton");
  const loginBtn  = document.getElementById("loginButton");
  const logoutBtn = document.getElementById("logoutButton");
  const userEmail = document.getElementById("userEmail");
  const reserveSection = document.getElementById("reservationSection");

  if (nameDiv)  nameDiv.textContent = "";
  if (emailDiv) emailDiv.textContent = "";
  if (img) {
    img.style.display = "none";
    img.removeAttribute("src");
  }
  if (sideLoginBtn)  sideLoginBtn.style.display  = "inline-block";
  if (sideLogoutBtn) sideLogoutBtn.style.display = "none";
  if (loginBtn)  loginBtn.style.display  = "inline-block";
  if (logoutBtn) logoutBtn.style.display = "none";
  if (userEmail) userEmail.textContent   = "";
  if (reserveSection) reserveSection.style.display = "none";

  // 2) æœ¬ä½“ã®ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
  firebase.auth().signOut().then(() => {
    alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ");
    const err = document.getElementById("errorMsg");
    if (err) err.textContent = "";

    // è¡¨ã‚’å†æç”»ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³UIã«æ›´æ–°ï¼‰
    if (selectedDate) loadSchedule(selectedDate);

    // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
    document.getElementById("sideMenu").classList.remove("visible");
    document.getElementById("menuOverlay").classList.remove("show");
  }).catch((e) => {
    console.warn("signOut failed:", e);
  });
}





</script>





</body>
</html>






